generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model alat {
  ID_ALAT           String              @id
  NAMA_ALAT         String?
  JUMLAH_ALAT       Int
  UNIT_ALAT         String?
  ALAT_LAYAK        Int                 @default(0)
  ALAT_TIDAK_LAYAK  Int                 @default(0)
  ALAT_KELUAR       Int                 @default(0)
  detail_permintaan detail_permintaan[]
}

model bahan {
  ID_BAHAN          String              @id
  NAMA_BAHAN        String?
  STOCK_BAHAN       Int?
  UNIT_BAHAN        String?
  BAHAN_KELUAR      Int                 @default(0)
  detail_permintaan detail_permintaan[]
}

model permintaan {
  ID_PERMINTAAN     String              @id
  ID_USER           Int?
  TGL_PERMINTAAN    DateTime?           @default(now())
  ID_PENGEMBALIAN   String?
  pengembalian      pengembalian?
  STATUS            STATUS_PERMINTAAN?  @default(PENDING)
  detail_permintaan detail_permintaan[]
  user              user?               @relation(fields: [ID_USER], references: [ID_USER], onDelete: Cascade, onUpdate: Restrict)

  @@index([ID_USER])
}

model user {
  ID_USER    Int          @id @default(autoincrement())
  NAME       String?
  USERNAME   String?
  PASSWORD   String?
  ROLE       String?
  REGISTER   DateTime?    @default(now())
  permintaan permintaan[]
}

model detail_permintaan {
  ID_DETAIL_PERMINTAAN String        @id @default(cuid())
  ID_PERMINTAAN        String
  ID_ALAT              String?
  ID_BAHAN             String?
  JUMLAH_ALAT          Int?
  JUMLAH_BAHAN         Int?
  ID_PENGEMBALIAN      String?
  alat                 alat?         @relation(fields: [ID_ALAT], references: [ID_ALAT], onDelete: Cascade)
  bahan                bahan?        @relation(fields: [ID_BAHAN], references: [ID_BAHAN], onDelete: Cascade)
  permintaan           permintaan    @relation(fields: [ID_PERMINTAAN], references: [ID_PERMINTAAN], onDelete: Cascade)
  pengembalian         pengembalian? @relation(fields: [ID_PENGEMBALIAN], references: [ID_PENGEMBALIAN], onDelete: Cascade)

  @@index([ID_PERMINTAAN])
}

model pengembalian {
  ID_PENGEMBALIAN   String              @id
  TGL_PENGEMBALIAN  DateTime            @default(now())
  ID_PERMINTAAN     String?             @unique
  permintaan        permintaan?         @relation(fields: [ID_PERMINTAAN], references: [ID_PERMINTAAN], onDelete: Cascade)
  detail_permintaan detail_permintaan[]
}

enum STATUS_PERMINTAAN {
  PENDING
  DIVERIFIKASI
  DITERIMA
  DIKEMBALIKAN
}
