generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model alat {
  ID_ALAT           String              @id
  NAMA_ALAT         String?
  JUMLAH_ALAT       Int
  UNIT_ALAT         String?
  ALAT_TIDAK_LAYAK  Int?                @default(0)
  ALAT_KELUAR       Int                 @default(0)
  detail_permintaan detail_permintaan[]
  perbaikan         perbaikan?
}

model perbaikan {
  ID_ALAT       String?          @unique
  KETERANGAN    String
  CATATAN       String?
  STATUS        STATUS_PERBAIKAN @default(PENDING)
  ID_PERBAIKAN  String           @id
  JUMLAH_ALAT   Int
  TGL_PENGAJUAN DateTime         @default(now())
  alat          alat?            @relation(fields: [ID_ALAT], references: [ID_ALAT], onDelete: Cascade)
}

model bahan {
  ID_BAHAN          String              @id
  NAMA_BAHAN        String?
  STOCK_BAHAN       Int?
  UNIT_BAHAN        String?
  BAHAN_KELUAR      Int                 @default(0)
  detail_permintaan detail_permintaan[]
}

model permintaan {
  ID_PERMINTAAN     String              @id
  ID_USER           Int?
  TGL_PERMINTAAN    DateTime?           @default(now())
  STATUS            STATUS_PERMINTAAN?  @default(PENDING)
  ID_PENGEMBALIAN   String?
  LOKASI_PROYEK     String
  NAMA_PROYEK       String
  TGL_PENGEMBALIAN  DateTime?
  TGL_PENGGUNAAN    DateTime?
  KETERANGAN        String?
  detail_permintaan detail_permintaan[]
  pengembalian      pengembalian?
  user              user?               @relation(fields: [ID_USER], references: [ID_USER], onDelete: Cascade, onUpdate: Restrict)

  @@index([ID_USER])
}

model user {
  ID_USER             Int                   @id @default(autoincrement())
  NAME                String?
  USERNAME            String?
  PASSWORD            String?
  ROLE                String?
  REGISTER            DateTime?             @default(now())
  permintaan          permintaan[]
  pengajuan_alat_baru pengajuan_alat_baru[]
}

model detail_permintaan {
  ID_DETAIL_PERMINTAAN String        @id @default(cuid())
  ID_PERMINTAAN        String
  JUMLAH_ALAT          Int?
  JUMLAH_BAHAN         Int?
  ID_PENGEMBALIAN      String?
  ID_ALAT              String?
  ID_BAHAN             String?
  alat                 alat?         @relation(fields: [ID_ALAT], references: [ID_ALAT], onDelete: Cascade)
  bahan                bahan?        @relation(fields: [ID_BAHAN], references: [ID_BAHAN], onDelete: Cascade)
  pengembalian         pengembalian? @relation(fields: [ID_PENGEMBALIAN], references: [ID_PENGEMBALIAN], onDelete: Cascade)
  permintaan           permintaan    @relation(fields: [ID_PERMINTAAN], references: [ID_PERMINTAAN], onDelete: Cascade)

  @@index([ID_PERMINTAAN])
}

model pengembalian {
  ID_PENGEMBALIAN   String              @id
  TGL_PENGEMBALIAN  DateTime            @default(now())
  ID_PERMINTAAN     String?             @unique
  detail_permintaan detail_permintaan[]
  permintaan        permintaan?         @relation(fields: [ID_PERMINTAAN], references: [ID_PERMINTAAN])
}

model pengajuan_alat_baru {
  ID_PENGAJUAN  String   @id
  NAMA_ALAT     String
  JUMLAH_ALAT   Int
  DESKRIPSI     String
  TGL_PENGAJUAN DateTime @default(now())
  ID_USER       Int
  user          user     @relation(fields: [ID_USER], references: [ID_USER], onDelete: Cascade)
}

enum STATUS_PERMINTAAN {
  PENDING
  DIVERIFIKASI
  DITERIMA
  DIKEMBALIKAN
  PENGEMBALIAN
  DIKIRIM
  DITOLAK
}

enum STATUS_PERBAIKAN {
  PENDING
  DIAJUKAN
  DITOLAK
  DIPERBAIKI
}
